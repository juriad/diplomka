%%% This file contains definitions of various useful macros and environments %%%
%%% Please add more macros here instead of cluttering other files with them. %%%

%%% Minor tweaks of style

% These macros employ a little dirty trick to convince LaTeX to typeset
% chapter headings sanely, without lots of empty space above them.
% Feel free to ignore.
\makeatletter
\def\@makechapterhead#1{
  {\parindent \z@ \raggedright \normalfont
   \Huge\bfseries \thechapter. #1
   \par\nobreak
   \vskip 20\p@
}}
\def\@makeschapterhead#1{
  {\parindent \z@ \raggedright \normalfont
   \Huge\bfseries #1
   \par\nobreak
   \vskip 20\p@
}}
\makeatother

% This macro defines a chapter, which is not numbered, but is included
% in the table of contents.
\def\chapwithtoc#1{
\chapter*{#1}
\addcontentsline{toc}{chapter}{#1}
}

% Draw black "slugs" whenever a line overflows, so that we can spot it easily.
\overfullrule=1mm

%%% Macros for definitions, theorems, claims, examples, ... (requires amsthm package)

\theoremstyle{plain}
\newtheorem{thm}{Theorem}
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{claim}[thm]{Claim}

\theoremstyle{plain}
\newtheorem{defn}{Definition}

\theoremstyle{remark}
\newtheorem*{cor}{Corollary}
\newtheorem*{rem}{Remark}
\newtheorem*{example}{Example}

%%% An environment for proofs

%%% FIXME %%% \newenvironment{proof}{
%%% FIXME %%%   \par\medskip\noindent
%%% FIXME %%%   \textit{Proof}.
%%% FIXME %%% }{
%%% FIXME %%% \newline
%%% FIXME %%% \rightline{$\square$}  % or \SquareCastShadowBottomRight from bbding package
%%% FIXME %%% }

%%% An environment for typesetting of program code and input/output
%%% of programs. (Requires the fancyvrb package -- fancy verbatim.)

\DefineVerbatimEnvironment{code}{Verbatim}{fontsize=\small, frame=single}

%%% The field of all real and natural numbers
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}

%%% Useful operators for statistics and probability
\DeclareMathOperator{\pr}{\textsf{P}}
\DeclareMathOperator{\E}{\textsf{E}\,}
\DeclareMathOperator{\var}{\textrm{var}}
\DeclareMathOperator{\sd}{\textrm{sd}}

%%% Transposition of a vector/matrix
\newcommand{\T}[1]{#1^\top}

%%% Various math goodies
\newcommand{\goto}{\rightarrow}
\newcommand{\gotop}{\stackrel{P}{\longrightarrow}}
\newcommand{\maon}[1]{o(n^{#1})}
\newcommand{\abs}[1]{\left|{#1}\right|}
\newcommand{\dint}{\int_0^\tau\!\!\int_0^\tau}
\newcommand{\isqr}[1]{\frac{1}{\sqrt{#1}}}

%%% Various table goodies
\newcommand{\pulrad}[1]{\raisebox{1.5ex}[0pt]{#1}}
\newcommand{\mc}[1]{\multicolumn{1}{c}{#1}}


%%% My own macros

\def\ph{\relax\ifmmode*\else$*$\fi}

\newcommand{\todo}[1]{}
\renewcommand{\todo}[1]{{\color{red} TODO: {#1}}}

\usepackage{tabularx}
\newcolumntype{L}[1]{>{\hsize=#1\hsize\raggedright\arraybackslash}X}%
\newcolumntype{J}[1]{>{\hyphenpenalty=100\hsize=#1\hsize\arraybackslash}X}%
\newcolumntype{R}[1]{>{\hsize=#1\hsize\raggedleft\arraybackslash}X}%
\newcolumntype{C}[2]{>{\hsize=#1\hsize\columncolor{#2}\centering\arraybackslash}X}%

\usepackage[noend]{algpseudocode}
\algrenewtext{Function}[2]{\algorithmicfunction\ \textsc{#1}(#2)\textbf{:}}
\algrenewtext{ForAll}[1]{\algorithmicforall\ #1\textbf{:}}
\algrenewtext{For}[1]{\algorithmicfor\ #1\textbf{:}}
\algrenewtext{While}[1]{\algorithmicwhile\ #1\textbf{:}}
\algrenewtext{If}[1]{\algorithmicif\ #1\textbf{:}}
\algrenewtext{ElsIf}[1]{\algorithmicelse\ \algorithmicif\ #1\textbf{:}}
\algrenewtext{Else}{\algorithmicelse\textbf{:}}

\algnewcommand\Break{\textbf{Break}}


\let\oldAlgorithmic\algorithmic
\let\oldEndAlgorithmic\endalgorithmic

\usepackage{float}
%\floatstyle{ruled}
\newfloat{program}{H}{lop}
\floatname{program}{Program}

\setlength{\floatsep}{5pt plus 2pt minus 2pt}
\setlength{\textfloatsep}{5pt plus 2pt minus 2pt}
\setlength{\intextsep}{5pt plus 2pt minus 2pt}

\def\algorithmic{\begin{program}\oldAlgorithmic}
\def\endalgorithmic{\oldEndAlgorithmic\end{program}}

\usepackage{environ}
% \RenewEnviron{algorithmic}[2][\relax]{}

\let\percent\%
\def\%{\ifmmode\mathbin{\percent}\else\percent\fi}

\newcommand{\bitnot}{\mathord{\sim}}
\newcommand{\bitand}{\mathbin{\&}}
\newcommand{\bitor}{\mathbin{|}}
\newcommand{\bitxor}{\mathbin{^\wedge}}
\newcommand{\bitlsh}{\mathbin{\ll}}
\newcommand{\bitrsh}{\mathbin{\gg}}

\newcommand{\boolnot}{\mathord{\textrm{not}\,}}
\newcommand{\booland}{\mathbin{\textrm{and}}}
\newcommand{\boolor}{\mathbin{\textrm{or}}}

\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}

\DeclareMathOperator{\textif}{\textrm{if}}
\DeclareMathOperator{\textthen}{\textrm{then}}
\DeclareMathOperator{\textelse}{\textrm{else}}
\DeclareMathOperator{\textotherwise}{\textrm{otherwise}}

\def\str#1{\relax\ifmmode\texttt{"#1"}\else\texttt{"#1"}\fi}
\def\openingParen{\str(}
\def\closingParen{\str)}

\usepackage{xifthen}
\newcommand{\defineName}[2][]{%
	\expandafter\def\csname \if\relax\detokenize{#1}\relax#2\else#1\fi\endcsname{\hyphenpenalty=500\relax\ifmmode\mathit{#2}\else\textsc{#2}\fi}%
}

% deque operations
\defineName{push}
\defineName{pop}
\defineName{enqueue}
\defineName{dequeue}

% output
\defineName[out]{output}

% in Foundations
\defineName{true}
\defineName{false}

% in Bit Strings, general definitions
\defineName{rank}
\defineName{select}
\defineName{inspect}
\defineName{pred}
\let\origSucc\succ
\defineName{succ}
\defineName{prev}
\defineName{next}

% in Bit Strings, rank
\defineName{block}
\defineName[glob]{global}

% in Bit Strings, select
\defineName[blockEnum]{block\_enum}
\defineName{blocks}
\defineName[smallBlockEnum]{small\_block\_enum}
\defineName[smallBlocks]{small\_blocks}

% in Bit Strings, balanced definitions
\defineName{match}
\defineName{enclose}
\defineName[findClose]{find\_close}
\defineName[findOpen]{find\_open}
\defineName{excess}
\defineName[parenDepth]{paren\_depth}
\defineName{rmqi}
\defineName{rmq}
\defineName{RMQi}
\defineName{RMQ}

% in Bit Strings, match, enclose
\defineName{far}
\defineName{paren}
\defineName[fwdSearch]{fwd\_search}
\defineName[bwdSearch]{fwd\_search}

% in Bits Strings, rmq
\defineName[rmqiSpan]{rmqi\_span}
\defineName{Tm}

% in Bit Strings, sublinear FID
\defineName[characteristicBlock]{characteristic\_block}

\newcommand{\defineRS}[2][]{%
	\def\name{\if\relax\detokenize{#1}\relax#2\else#1\fi}
	\expandafter\defineName\expandafter[\name Rank]{#2\_rank}
	\expandafter\defineName\expandafter[\name Select]{#2\_select}
	\expandafter\defineName\expandafter[\name Any]{#2\_\ph}
}

\newcommand{\defineOps}[2][]{%
	\edef\name{\if\relax\detokenize{#1}\relax#2\else#1\fi}
	\expandafter\defineName\expandafter[\name Rank]{#2\_rank}
	\expandafter\defineName\expandafter[\name Select]{#2\_select}
	\expandafter\defineName\expandafter[\name Prev]{#2\_prev}
	\expandafter\defineName\expandafter[\name Next]{#2\_next}
	\expandafter\defineName\expandafter[\name First]{#2\_first}
	\expandafter\defineName\expandafter[\name Last]{#2\_last}
	\expandafter\defineName\expandafter[\name Size]{#2\_size}
	\expandafter\defineName\expandafter[\name Any]{#2\_\ph}
}

% in Trees, operations
\defineOps[any]{\ph}
\defineRS{pre}
\defineRS{post}
\defineRS{in}
\defineRS{dfuds}
\defineRS{lo}

\defineOps{child}
\defineName{degree}
\defineName{parent}
\defineName[isRoot]{is\_root}

\defineOps{level}
\defineName[dep]{depth}

\defineOps{leaf}
\defineName[isLeaf]{is\_leaf}

\defineName[isAncestor]{is\_ancestor}
\defineName[levelAncestor]{level\_ancestor}
\defineName{lca}
\defineName{distance}

\defineName[hei]{height}
\defineName[deepestVertex]{deepest\_vertex}
\defineName[subtreeSize]{subtree\_size}

% representations
\defineName[LOUDSRepresentation]{LOUDS\_representation}
\defineName[BPRepresentation]{BP\_representation}
\defineName[DFUDSRepresentation]{DFUDS\_representation}

% in Trees, LOUDS
\defineName{children}
\defineName[toOnes]{to\_ones}
\defineName[toZeros]{to\_zeros}
\defineName[toBeginning]{to\_beginning}
\defineName[blockOfD]{block\_of\_D}

% in Trees, BP
\defineName{state}
\defineName{reverse}
\defineName[UNSEEN]{\str{UNSEEN}}
\defineName[OPEN]{\str{OPEN}}
\defineName[CLOSED]{\str{CLOSED}}

% in Trees, DFUDS
\defineName[toEnd]{to\_end}
\defineName[toLast]{to\_last}
\defineName[toSymetric]{to\_symetric}

% in structures, FF
\defineName[summ]{sum}

\usepackage[nobottomtitles*]{titlesec}
\renewcommand{\bottomtitlespace}{.2\textheight}

\usepackage[section]{placeins}